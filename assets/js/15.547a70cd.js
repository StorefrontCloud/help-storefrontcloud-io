(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{351:function(e,t,n){"use strict";n.r(t);var a=n(42),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"ci-stages"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ci-stages"}},[e._v("#")]),e._v(" CI Stages")]),e._v(" "),n("p",[e._v("In "),n("code",[e._v(".gitlab-ci.yml")]),e._v(" are defined as four stages of continuous integration for your projects.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("stages:\n  - test\n  - build\n  - deploy\n  - deploy-check\n")])])]),n("h2",{attrs:{id:"test"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test"}},[e._v("#")]),e._v(" Test")]),e._v(" "),n("p",[e._v("In this stage are running unit tests and static code analysis.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("sca:\n  stage: test\n  image: node:10\n  script:\n    - yarn install\n    - yarn lint\n\nunit:\n  stage: test\n  image: node:10\n  script:\n    - yarn install\n    - yarn test:unit\n")])])]),n("h2",{attrs:{id:"build"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[e._v("#")]),e._v(" Build")]),e._v(" "),n("p",[e._v("This stage is responsible for building a docker image with the application. More information is in dedicated "),n("RouterLink",{attrs:{to:"/guide/ci/build-docker-image.html"}},[e._v("article")]),e._v(".")],1),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('build:\n  stage: build\n  image:\n    name: gcr.io/kaniko-project/executor:debug\n    entrypoint: [""]\n  script:\n    - echo "{\\"auths\\":{\\"$REGISTRY_URL\\":{\\"username\\":\\"$REGISTRY_USER\\",\\"password\\":\\"$REGISTRY_PASSWORD\\"}}}" > /kaniko/.docker/config.json\n    - TAG=${CI_COMMIT_SHA:0:8}\n    - if [ -n "$CI_COMMIT_TAG" ]; then TAG=$CI_COMMIT_TAG; fi\n    - /kaniko/executor --context $CI_PROJECT_DIR --dockerfile $CI_PROJECT_DIR/dev/docker/Dockerfile --destination $REGISTRY_IMAGE:$TAG\n  only:\n    - develop\n    - tags\n')])])]),n("h2",{attrs:{id:"deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[e._v("#")]),e._v(" Deployment")]),e._v(" "),n("p",[e._v("The next stage is deployed to the test environment or the production environment. It is a simple API call to our tool responsible for the deploy and it only triggers deploy. Information about success is in the next stage. More information is in dedicated "),n("RouterLink",{attrs:{to:"/guide/ci/deployment.html"}},[e._v("article")]),e._v(".")],1),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('deploy-to-staging:\n  stage: deploy\n  image: alpine\n  script:\n    - apk add --no-cache curl\n    - >\n      curl -H "Content-Type: application/json" -X POST -d "{\\"code\\":\\"demo-test-storefrontcloud-io\\", \\"frontContainerVersion\\":\\"${CI_COMMIT_SHA:0:8}\\"}" http://10.29.1.1:4000/instances\n  environment:\n    name: staging\n    url: https://demo-test.storefrontcloud.io/\n  only:\n    - develop\n')])])]),n("h2",{attrs:{id:"deploy-check"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deploy-check"}},[e._v("#")]),e._v(" Deploy Check")]),e._v(" "),n("p",[e._v("In this stage we confir if deployment success.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('deploy-to-staging-check:\n  stage: deploy-check\n  image:\n    name: registry.storefrontcloud.io/deploy-checker\n    entrypoint: ["/bin/bash"]\n  script:\n    - cd /usr/src/app\n    - echo $KUBE_CONFIG_TEST | base64 --decode > /tmp/kubeconfig\n    - bundle exec ruby deploy_checker.rb --tag ${CI_COMMIT_SHA:0:8} --kubeconfig /tmp/kubeconfig --namespace cletile-test-us-east-1-aws-storefrontcloud-io\n  only:\n    - develop\n\n')])])])])}),[],!1,null,null,null);t.default=s.exports}}]);